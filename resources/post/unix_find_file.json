{
    "id" : "2",
    "level" : "Expert",
    "tags" :["ambiguity", "ood"],
    "date" : "24-Dec-2020",
    "title" : "Designing File Search",
    "description" : "A walkthrough of designing a File Search and how we can think about extensibility",   
    "body" : "<h3><strong>The Question</strong></h3><p>Implement the find command.&nbsp;Initial usecases are:</p><ul><li>Find files over 150 MB.</li><li>Find PDF files.</li></ul><p>Create a library that lets me do this easily. The code should be easily extensible to other usecases.</p><div>&nbsp;</div><h3><strong>The Test</strong></h3><p>The test is to identify that these are just 2 uses cases and that the library should be flexible enough to support all that we might need from a search service. Ofc we wont build everthing today but we need to leave room for those developments to come along easily. The key here is understanding that we are building a \"Find\" Service/library.</p><h3><strong>The Approaches</strong></h3><p>As a Snr SDE you are expected to understand that the 2 usecases are merely a query string to our search service. Although hardcoded, it is important to probe if there is a scope of extention of query language and will user be able to&nbsp;SOMEDAY&nbsp;provide search queries.</p><p>From the above we can deduce that the SDE must ask:</p><ol><li>Will there be more&nbsp;params which can be used to query creation other than Filesize or type.</li><li>Will there ever be combined to create a complex query.</li></ol><p>If you we able to reach the above two questions, congratulations you have solved the toughest part of the question.</p><p>&nbsp;</p><h3><strong>The Solution</strong></h3><p><strong>Milstones</strong></p><ol><li>Implement FindFile API.</li><li>Create a rule matcher interface for abstraction (interface with match method).</li><li>Implement simple&nbsp;DFS/BFS&nbsp;file search.</li><li>Implement both use cases using matcher abstraction.&nbsp;</li><li>Implement logical operators for matcher (AND and OR).&nbsp;</li><li>Write code snippets showing how to use FindFile API.</li></ol><p>Additionally as an edge case you&nbsp;should think of \"handling symbolic links\".</p><p>&nbsp;</p><p><strong>Psudo Code eg</strong></p><div class=\"code\"><p>interface FileRule {<br /> &nbsp;&nbsp;&nbsp;public boolean match(File f);<br />}<br /><br />class&nbsp;ExtentionRule implements FileRule {<br />&nbsp; &nbsp; boolean match(File f) {<br />&nbsp; &nbsp; &nbsp; &nbsp;return if&nbsp; file ends with \"extention\"<br /> &nbsp;&nbsp;&nbsp;}<br />}<br /><br />public class FileRuleSize implements FileRule {<br /> &nbsp;&nbsp;&nbsp;enum FileRuleSizeOp {<br />&nbsp; &nbsp; &nbsp; &nbsp; LessThan,<br />&nbsp; &nbsp; &nbsp; &nbsp; Equal,<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;.</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;.<br /> &nbsp;&nbsp;&nbsp;};<br /><br /><br />&nbsp;boolean match(File f) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (op) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caseLessThan:<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return f.length() &lt; size;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br /> &nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;ANDRule implements FileRule {<br />&nbsp; &nbsp; List&lt;FileRule&gt; andRules;<br /><br /> &nbsp;&nbsp;&nbsp;boolean match(File f) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (FileRule rule : andRules) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!rule.match(f)) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br /> &nbsp;&nbsp;&nbsp;}<br />}</p><p>class&nbsp;ORRule implements FileRule {<br />&nbsp; &nbsp; List&lt;FileRule&gt; orRules;<br /><br />&nbsp;&nbsp;&nbsp;boolean match(File f) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (FileRule rule :orRules) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rule.match(f)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br />&nbsp;&nbsp;&nbsp;}<br />}<br /><br /><br />public class FindFile {<br /> &nbsp;&nbsp;&nbsp;public static void find(String dir, FileRule rule) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File baseDir = new File(dir);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (baseDir.isDirectory()) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (File f : baseDir.listFiles()) {<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rule.match(f)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(f.getName());<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;}<br /><br /> &nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileRule rule = new ORRule(<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new ExtentionRule(\"java\"),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new ANDRule(<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new ExtentionRule(\"zip\"),<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new FileRuleSize(5711472, FileRuleSize.FileRuleSizeOp.EQUAL)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find(\"/local/home\", rule);<br /> &nbsp;&nbsp;&nbsp;}<br />}</p></div>",
    "endText": ""
}